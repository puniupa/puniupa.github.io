---
title: "位相的機械学習<br>――データはもはや「ただの数字」ではない――"
subtitle: "これから AI で加速する産業分野はどこか？"
author: "ぷに"
date: 8/7/2024
categories: [AI]
bibliography: 
    - ../../../assets/mathematics.bib
    - ../../../assets/bib.bib
csl: ../../../assets/apalike.csl
abstract: TDL (Topological Deep Learning) とは，幾何学的な概念によって深層学習を（再）解釈しようとする立場であり，近年急速な盛り上がりを見せている．こういうと理論的な話に聞こえるかも知れないが，幾何学の概念を AI 利用に取り入れることは，半導体，ニューロサイエンスなど，幅広い科学分野において重要なステップである．従って，位相的機械学習は今後とも，理論だけでなく応用と実践が交差するキーワードとなっていくと期待されている．
---

{{< include ../../../assets/_preamble.qmd >}}

## なぜ位相的機械学習が必要とされたか？

### 従来手法の反省点

どうして「位相」が機械学習におけるキーワードとして再注目されているかというと，「以前の我々は，座標の取り方に関して無関心だったから」だと言える．

これまでの深層学習のアーキテクチャは，モデリングの対象が言語・音声・動画のどれであるかに依らず，

![](Images/legacy.svg)

という同一のステップを辿っていた．

しかし，深層学習の応用先が広がっていくごとに，次のような例が見つかってきた：

::: {.callout-important appearance="simple" icon="false"}

* 分子は従来のように３次元座標ベクトルでモデリングするより，グラフとしてモデリングした方が良い [@Velickovic2023]．^[有機化合物は，分枝の構造を文字列で表した SMILES 文字列や，３次元座標で原子の位置を表した MOL ファイルなどで表される [@船津公人+2024]．]
* 画像は（従来のようなテンソルだと思うより）実はグラフだと思った方が，幾何学的な情報を取り入れたモデリングができる [@Han+2022]．^[[@Han+2022] はグラフニューラルネットワークが，Vision Transformer に画像分類や物体認識など多くのタスクで優ったことを報告している．]
* 電子カルテ (EHR) は数値・文章・画像の複数のメディアを含むため，従来の機械学習の適用が困難であったが，その情報をグラフの形でまとめることで，患者の発作リスクや必要な投薬などを予想する精度が向上してきている [@Choi+2020]．
* fMRI から取得される脳の画像データは，脳の部位の機能的な結合を意味するグラフの形でモデリングすることで，より多くの情報抽出と科学的発見の促進が可能になっている [@Ktena+2018]．

:::

### ベクトルを超えていく

**根本的な問題は，従来のデータ解析では Euclid 空間 $\R^d$ 以外の空間を考えてこなかったことにある**．

それゆえ，どんなデータもまずは $\R^d$ 内に埋め込むことが考えられ，モデリング法の多様性が失われていたのだと言える．

画像を文字列のような系列だと捉えたり，分子を文字列としてモデリングしたりする様子は，大変に奇怪である．

#### 幾何学的深層学習

そこで **幾何学的深層学習** (GDL: Geometric Deep Learning) の標語の下で，従来の Euclid 空間 $\R^d$ 以外にも，多様な空間上のデータをモデリングをする方法論が研究された．

これにより，「ベクトル」以外の言葉でデータを見ることが可能になったのである．

「ベクトル」以外の言葉として最初に探索されたものが「グラフ」であり，グラフニューラルネットワーク (GNN) が幾何学的深層学習の中心的な柱となっている．

::: {.callout-tip collapse="true" icon="false" title="よりみち（幾何学的深層学習の成果）"}

* 幾何学的な語彙でデータの構造を捉える **パーシステント・ホモロジー** (persistent homology) という手法 [@Edelsbrunner+2002], [@Zomorodian-Carlsson2005] を取り入れた手法が，[D3R](https://drugdesigndata.org/about/grand-challenge) (Drug Design Data Resorce) Grand Challenge という世界規模の新薬創出コンテストにおいて，リガンドのポーズ予測や親和度推定など多くのタスクで１位を獲得した [@Nguyen+2019], [@Nguyen+2020]．
* 光学顕微鏡による全能画像データをニューロン区画の階層に分割するタスクは従来は経験豊富な神経科学者のみの職人技であった．大量の教師ありデータを取得できるはずもないので，深層学習の応用は困難であったが，**離散モース理論** によりデータの構造を捉えることで，人間の 90% の正解率に迫っている [@Banerjee+2020], [@Hu+2021]．

:::

#### グラフを超えていく

しかしすでに，グラフを超えていく動きの萌芽も見られる [@Hajij+2023]．

そのためには，数学の言葉に注目することが肝要である．幾何学には，十数世紀以上の抽象化の蓄積があり，[単体複体](https://ja.wikipedia.org/wiki/複体) [@Schaub+2022] や[胞体複体](https://ja.wikipedia.org/wiki/CW複体) [@Hajij+2020] などの概念が，最初のとっかかりとなっている．

[@Hansen-Ghrist2019] では，スペクトル層理論というスペクトルグラフ理論 [@Chung1997] の拡張が展開されている．


### 位相的機械学習が目指すもの

以上，**それぞれのデータに自然な表現を選ぶ** ことが大事であることはわかっていただけただろう．

* 創薬において，有機分子が目標のタンパク質に結合するかの判定のために，有機分子を文字列で表してトランスフォーマーに学習させる．
* 画像において，ニューロンの区画をモデリングするために，画像をグラフで表してトランスフォーマーに学習させる．

という営みは，トランスフォーマーというアーキテクチャが言語（だけ）のために制作された当初の意図からすると，大変不本意である．^[例えば，トランスフォーマーは２体間相互作用のモデリングには優れているが，３体間相互作用のモデリングは大変不得意である [@Stanford+2023]．] （機械学習の黎明期において，必要な試行錯誤であることは間違いないが，）

深層学習が，化学，薬学，神経科学，社会学などの各分野で真にイノベーションを産むためには，その分野にあったアーキテクチャの特定が必要である．

「各分野の各データに最もあったアーキテクチャは何か？」という指標を，**幾何学を指導原理として与えよう** というのが位相的機械学習である．

これにより，次の２点を達成することが目標である：

::: {.callout-tip appearance="simple" icon="false"}

1. **幾何学的なことばで** データを理解する．（グラフか？）
2. データの位相的性質にあった機械学習アーキテクチャを選べる．

:::

## 位相的機械学習の「いま」

位相的機械学習 (TDL) の目指すところを，各分野での成功事例で見ていこう．

### 分子モデリング

### SARS-CoV-2 変異株予測

コロナウィルスの変異株にはオミクロン株という名前がついている．

実はオミクロン株にもさらに分類があり，当初の系統は BA.1 である．

BA.2 系統 [@Chen-Wei2022] と BA.4, BA.5 系統 [@Chen+2022] との登場可能性とその性質（感染力は？既存のワクチンが効くか？）を，２ヶ月以上前に「変異懸念株」として予測することに成功したのは，代数トポロジーの知見を取り入れた TDL 手法であった．

パーシステントホモロジーなどの代数トポロジーの手法は，分子間／分子内相互作用を記述するのに優れており，特に SARS-CoV-2 変異株の新たなスパイクタンパク質がどのような[リガンド](https://ja.wikipedia.org/wiki/リガンド)に結合し得るかの予測に優れていた [@Chan+2018]．

SARS-CoV-2 やその変異株の迅速なワクチン開発の背後で暗躍していたのは，TDL だったのである．

### タンパク質の構造予測と生成

Google DeepMind の AlphaFold 2 は主にトランスフォーマーを用いた深層模型で，2020 年の [タンパク質構造予測精密評価](https://ja.wikipedia.org/wiki/タンパク質構造予測精密評価) (CASP14) で驚異的な成績で優勝した．

たんぱく質の構造生成において，[@Hoogeboom+2022] 以来は同変性を備えたグラフニューラルネットワークによる拡散模型の使用も進んでいる．なお，AlphaFold 3 [@Abramson+2024] でも拡散模型が取り入れられている．

> Deep Learning で大規模分子の構造分布を予測するなんて数年前には考えられませんでしたが、拡散モデルによってすでに現実になりつつあります。^[[メンダコ氏のブログ](https://horomary.hatenablog.com/entry/2024/06/30/211033#AlphaFold3-2024) より．]

### 電子顕微鏡

## 文献紹介 {.appendix}

サーベイかつポジションペーパー [@Papamarkou+2024TDL] を大いに参考にした．

[@Nguyen+2019] は，マルチスケール重みつき色つき部分グラフとパーシステント・ホモロジーを取り入れた深層学習手法により，D3R Grand Challenge 2 の stage 2 での[絶対自由エネルギー予測 set 1](https://drugdesigndata.org/php/d3r/gc2/combined/free-energy/index.php?component=443&q=rmsd&set=1&partial=0) において１位を獲得し，続いて Challenge 3 では 26 のタスクのうち 10 タスクで１位を獲得したことを報告している．

パーシステントホモロジーについて，液体シリカとアモルファスシリカの分子動力学シミュレーション結果を例に取り，パーシステント図式などの方法でデータの位相的構造を取り出している様子が [@大林一平2018] で詳細に解説されている．論文としては [@Hiraoka+2016], [@Ichinomiya+2017] に対応する．同著者によるより数学的なものは [@大林一平2017]．[平岡裕章研究室](https://sites.google.com/view/hiraoka-lab/)の[研究紹介スライド](https://www.wpi-aimr.tohoku.ac.jp/hiraoka_labo/introduction_j.pdf)も参照．

[@Hansen-Ghrist2019] では，スペクトル層理論という理論を展開している．これは，スペクトルグラフ理論 [@Chung1997] を，一般の胞体層 (cellular sheaf) に拡張したものであるという．組み合わせ論的なグラフラプラシアンを，正則な胞体複体上の線型空間の胞体層上の Hodge ラプラシアンの特別な場合と見ることで，スペクトルデータを層のコホモロジーや胞体構造と関連づけることが出来るという．

グラフカーネルに関する良い日本語文献に [@ガラムカリ和2021] がある．

## 個人的な [@Papamarkou+2024TDL] の見どころ {.appendix}

Computer Vision の分野に続いて，構造生成の分野でも Diffusion model が state of the art となったことが触れられている（[@Zhang+2023] も参照）：

> In addition to 2D and 3D computer vision, diffusion models have become the state-of-the-art in graphbased molecular generation. [@Papamarkou+2024TDL]

これが [@Bodnar+2022] で Neural Sheaf Diffusion に発展しようとしている．これはグラフ上の層を考えることで，グラフ上に更なる幾何的構造を作り込み，データのより高次の構造を捉えることができるようにしようというものである（この枠組みでは，Graph Neural Network は自明な層を扱った場合，と相対化される）．

個人的には，Gauss 過程が Banach 空間の研究に応用できたこと，拡散過程が多様体やグラフの局所構造を捉えることが，単に数学的な特徴付けであることを超えて，効率的な計算手法として，計算機科学として，計算数学として発展する具体的な試みが，TDL の名前の下に総覧できる点が大変に興味深い．

> For example, a combination of applied category theory and TDA may lead to algorithms that automatically summarize how neural networks produce their output, making deep learning more understandable to humans. [@Papamarkou+2024TDL]

ランダムウォークを用いて，単体複体の表現学習を行うという展開もある Simplex2Vec [@Billings+2019], [@Schaub+2020]

TDL / GDL は初めての幾何学を指導原理としたエンジニアリングになるかもしれない．多様体を超えた一般的な幾何学的な枠組みが，層の言葉で作られるかもしれない．

[@Bronstein+2021] も良い本である．